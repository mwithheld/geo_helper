<?php
/*
 * This file is part of the GeoHelper library.
 *
 * (c) Matthew Vince <matthew.vince@phaseshiftllc.com>
 *
 * This source file is subject to the MIT license that is bundled
 * with this source code in the file LICENSE.
 */ 
 
class GoogleGeocoderTest extends BaseGeocoderTestCase
{
   const GOOGLE_SUCCESS = <<<EOT
<?xml version="1.0" encoding="UTF-8"?>
<GeocodeResponse><status>OK</status><result><type>street_address</type><formatted_address>100 Spear St, San Francisco, CA 94105, USA</formatted_address><address_component><long_name>100</long_name><short_name>100</short_name><type>street_number</type></address_component><address_component><long_name>Spear St</long_name><short_name>Spear St</short_name><type>route</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>94105</long_name><short_name>94105</short_name><type>postal_code</type></address_component><geometry><location><lat>37.7921509</lat><lng>-122.3940000</lng></location><location_type>ROOFTOP</location_type><viewport><southwest><lat>37.7890033</lat><lng>-122.3971476</lng></southwest><northeast><lat>37.7952985</lat><lng>-122.3908524</lng></northeast></viewport></geometry></result></GeocodeResponse>
EOT;

   const GOOGLE_WITH_BOUNDS = <<<EOT
<?xml version="1.0" encoding="UTF-8"?>
<GeocodeResponse><status>OK</status><result><type>neighborhood</type><type>political</type><formatted_address>Winnetka, Los Angeles, CA, USA</formatted_address><address_component><long_name>Winnetka</long_name><short_name>Winnetka</short_name><type>neighborhood</type><type>political</type></address_component><address_component><long_name>Los Angeles</long_name><short_name>Los Angeles</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>San Fernando Valley</long_name><short_name>San Fernando Valley</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>Los Angeles</long_name><short_name>Los Angeles</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><geometry><location><lat>34.2133300</lat><lng>-118.5711100</lng></location><location_type>APPROXIMATE</location_type><viewport><southwest><lat>34.1948738</lat><lng>-118.6031248</lng></southwest><northeast><lat>34.2317822</lat><lng>-118.5390952</lng></northeast></viewport><bounds><southwest><lat>34.1791050</lat><lng>-118.5883200</lng></southwest><northeast><lat>34.2353090</lat><lng>-118.5534191</lng></northeast></bounds></geometry></result></GeocodeResponse>
EOT;

   const GOOGLE_MULTIPLE = <<<EOT
<?xml version="1.0" encoding="UTF-8"?>
<GeocodeResponse><status>OK</status><result><type>route</type><formatted_address>Summer Breeze Dr, Jacksonville, FL 32218, USA</formatted_address><address_component><long_name>Summer Breeze Dr</long_name><short_name>Summer Breeze Dr</short_name><type>route</type></address_component><address_component><long_name>Jacksonville</long_name><short_name>Jacksonville</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>Jacksonville</long_name><short_name>Jacksonville</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>Duval</long_name><short_name>Duval</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>Florida</long_name><short_name>FL</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>32218</long_name><short_name>32218</short_name><type>postal_code</type></address_component><geometry><location><lat>30.4910979</lat><lng>-81.6105369</lng></location><location_type>GEOMETRIC_CENTER</location_type><viewport><southwest><lat>30.4856299</lat><lng>-81.6128239</lng></southwest><northeast><lat>30.4965780</lat><lng>-81.6065286</lng></northeast></viewport><bounds><southwest><lat>30.4856299</lat><lng>-81.6122325</lng></southwest><northeast><lat>30.4965780</lat><lng>-81.6071200</lng></northeast></bounds></geometry></result><result><type>route</type><formatted_address>Summer Breeze Dr, Colorado Springs, CO 80918, USA</formatted_address><address_component><long_name>Summer Breeze Dr</long_name><short_name>Summer Breeze Dr</short_name><type>route</type></address_component><address_component><long_name>Colorado Springs</long_name><short_name>Colorado Springs</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>Colorado Springs</long_name><short_name>Colorado Springs</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>El Paso</long_name><short_name>El Paso</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>Colorado</long_name><short_name>CO</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>80918</long_name><short_name>80918</short_name><type>postal_code</type></address_component><geometry><location><lat>38.9178268</lat><lng>-104.7572486</lng></location><location_type>GEOMETRIC_CENTER</location_type><viewport><southwest><lat>38.9149574</lat><lng>-104.7607324</lng></southwest><northeast><lat>38.9212526</lat><lng>-104.7544371</lng></northeast></viewport><bounds><southwest><lat>38.9167370</lat><lng>-104.7604620</lng></southwest><northeast><lat>38.9194730</lat><lng>-104.7547075</lng></northeast></bounds></geometry></result><result><type>route</type><formatted_address>Summer Breeze Dr, Pearland, TX 77584, USA</formatted_address><address_component><long_name>Summer Breeze Dr</long_name><short_name>Summer Breeze Dr</short_name><type>route</type></address_component><address_component><long_name>Pearland</long_name><short_name>Pearland</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>Alvin-Pearland</long_name><short_name>Alvin-Pearland</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>Brazoria</long_name><short_name>Brazoria</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>Texas</long_name><short_name>TX</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>77584</long_name><short_name>77584</short_name><type>postal_code</type></address_component><geometry><location><lat>29.5609301</lat><lng>-95.3701607</lng></location><location_type>GEOMETRIC_CENTER</location_type><viewport><southwest><lat>29.5579018</lat><lng>-95.3736983</lng></southwest><northeast><lat>29.5641971</lat><lng>-95.3674031</lng></northeast></viewport><bounds><southwest><lat>29.5608709</lat><lng>-95.3732978</lng></southwest><northeast><lat>29.5612280</lat><lng>-95.3678036</lng></northeast></bounds></geometry></result><result><type>route</type><formatted_address>Summer Breeze Dr, Mission, TX 78572, USA</formatted_address><address_component><long_name>Summer Breeze Dr</long_name><short_name>Summer Breeze Dr</short_name><type>route</type></address_component><address_component><long_name>Mission</long_name><short_name>Mission</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>Mission</long_name><short_name>Mission</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>Hidalgo</long_name><short_name>Hidalgo</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>Texas</long_name><short_name>TX</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>78572</long_name><short_name>78572</short_name><type>postal_code</type></address_component><geometry><location><lat>26.2223153</lat><lng>-98.2883666</lng></location><location_type>GEOMETRIC_CENTER</location_type><viewport><southwest><lat>26.2197089</lat><lng>-98.2918258</lng></southwest><northeast><lat>26.2260041</lat><lng>-98.2802315</lng></northeast></viewport><bounds><southwest><lat>26.2223152</lat><lng>-98.2918258</lng></southwest><northeast><lat>26.2233978</lat><lng>-98.2802315</lng></northeast></bounds></geometry></result><result><type>route</type><formatted_address>Summer Breeze Dr, Banning, CA 92220, USA</formatted_address><address_component><long_name>Summer Breeze Dr</long_name><short_name>Summer Breeze Dr</short_name><type>route</type></address_component><address_component><long_name>Banning</long_name><short_name>Banning</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>Idyllwild</long_name><short_name>Idyllwild</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>Riverside</long_name><short_name>Riverside</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>92220</long_name><short_name>92220</short_name><type>postal_code</type></address_component><geometry><location><lat>33.8644459</lat><lng>-116.8191724</lng></location><location_type>GEOMETRIC_CENTER</location_type><viewport><southwest><lat>33.8610448</lat><lng>-116.8245376</lng></southwest><northeast><lat>33.8673401</lat><lng>-116.8182423</lng></northeast></viewport><bounds><southwest><lat>33.8613519</lat><lng>-116.8236140</lng></southwest><northeast><lat>33.8670330</lat><lng>-116.8191659</lng></northeast></bounds></geometry></result><result><type>route</type><formatted_address>Summer Breeze Dr, Villa Rica, GA 30180, USA</formatted_address><address_component><long_name>Summer Breeze Dr</long_name><short_name>Summer Breeze Dr</short_name><type>route</type></address_component><address_component><long_name>Villa Rica</long_name><short_name>Villa Rica</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>Winston</long_name><short_name>Winston</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>Douglas</long_name><short_name>Douglas</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>Georgia</long_name><short_name>GA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>30180</long_name><short_name>30180</short_name><type>postal_code</type></address_component><geometry><location><lat>33.7357410</lat><lng>-84.8735523</lng></location><location_type>GEOMETRIC_CENTER</location_type><viewport><southwest><lat>33.7328657</lat><lng>-84.8767430</lng></southwest><northeast><lat>33.7391610</lat><lng>-84.8704478</lng></northeast></viewport><bounds><southwest><lat>33.7346141</lat><lng>-84.8741196</lng></southwest><northeast><lat>33.7374126</lat><lng>-84.8730712</lng></northeast></bounds></geometry></result><result><type>route</type><formatted_address>Summer Breeze Dr, Leesville, SC 29070, USA</formatted_address><address_component><long_name>Summer Breeze Dr</long_name><short_name>Summer Breeze Dr</short_name><type>route</type></address_component><address_component><long_name>Leesville</long_name><short_name>Leesville</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>Gilbert</long_name><short_name>Gilbert</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>Lexington</long_name><short_name>Lexington</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>South Carolina</long_name><short_name>SC</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>29070</long_name><short_name>29070</short_name><type>postal_code</type></address_component><geometry><location><lat>34.0367670</lat><lng>-81.4367703</lng></location><location_type>GEOMETRIC_CENTER</location_type><viewport><southwest><lat>34.0330546</lat><lng>-81.4395515</lng></southwest><northeast><lat>34.0393498</lat><lng>-81.4332563</lng></northeast></viewport><bounds><southwest><lat>34.0351050</lat><lng>-81.4383208</lng></southwest><northeast><lat>34.0372994</lat><lng>-81.4344870</lng></northeast></bounds></geometry></result><result><type>route</type><formatted_address>Summer Breeze Dr, Moreno Valley, CA 92557, USA</formatted_address><address_component><long_name>Summer Breeze Dr</long_name><short_name>Summer Breeze Dr</short_name><type>route</type></address_component><address_component><long_name>Moreno Valley</long_name><short_name>Moreno Valley</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>Riverside</long_name><short_name>Riverside</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>Riverside</long_name><short_name>Riverside</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>92557</long_name><short_name>92557</short_name><type>postal_code</type></address_component><geometry><location><lat>33.9675392</lat><lng>-117.2291438</lng></location><location_type>GEOMETRIC_CENTER</location_type><viewport><southwest><lat>33.9638931</lat><lng>-117.2327360</lng></southwest><northeast><lat>33.9701884</lat><lng>-117.2264408</lng></northeast></viewport><bounds><southwest><lat>33.9657050</lat><lng>-117.2304078</lng></southwest><northeast><lat>33.9683765</lat><lng>-117.2287690</lng></northeast></bounds></geometry></result><result><type>route</type><formatted_address>Summer Breeze Dr, Columbus, OH 43223, USA</formatted_address><address_component><long_name>Summer Breeze Dr</long_name><short_name>Summer Breeze Dr</short_name><type>route</type></address_component><address_component><long_name>Columbus</long_name><short_name>Columbus</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>Columbus</long_name><short_name>Columbus</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>Franklin</long_name><short_name>Franklin</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>Ohio</long_name><short_name>OH</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>43223</long_name><short_name>43223</short_name><type>postal_code</type></address_component><geometry><location><lat>39.9234130</lat><lng>-83.0519920</lng></location><location_type>GEOMETRIC_CENTER</location_type><viewport><southwest><lat>39.9202119</lat><lng>-83.0557761</lng></southwest><northeast><lat>39.9265071</lat><lng>-83.0494809</lng></northeast></viewport><bounds><southwest><lat>39.9222690</lat><lng>-83.0538580</lng></southwest><northeast><lat>39.9244500</lat><lng>-83.0513990</lng></northeast></bounds></geometry></result><result><type>route</type><formatted_address>Summer Breeze Dr, Graniteville, SC 29829, USA</formatted_address><address_component><long_name>Summer Breeze Dr</long_name><short_name>Summer Breeze Dr</short_name><type>route</type></address_component><address_component><long_name>Graniteville</long_name><short_name>Graniteville</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>Aiken</long_name><short_name>Aiken</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>Aiken</long_name><short_name>Aiken</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>South Carolina</long_name><short_name>SC</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>29829</long_name><short_name>29829</short_name><type>postal_code</type></address_component><geometry><location><lat>33.5721000</lat><lng>-81.8645400</lng></location><location_type>GEOMETRIC_CENTER</location_type><viewport><southwest><lat>33.5672940</lat><lng>-81.8668811</lng></southwest><northeast><lat>33.5767630</lat><lng>-81.8605859</lng></northeast></viewport><bounds><southwest><lat>33.5672940</lat><lng>-81.8653930</lng></southwest><northeast><lat>33.5767630</lat><lng>-81.8620740</lng></northeast></bounds></geometry></result></GeocodeResponse>
EOT;

   const GOOGLE_REVERSE = <<<EOT
<?xml version="1.0" encoding="UTF-8"?>
<GeocodeResponse><status>OK</status><result><type>street_address</type><formatted_address>120 11th St, San Francisco, CA 94103, USA</formatted_address><address_component><long_name>120</long_name><short_name>120</short_name><type>street_number</type></address_component><address_component><long_name>11th St</long_name><short_name>11th St</short_name><type>route</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><address_component><long_name>94103</long_name><short_name>94103</short_name><type>postal_code</type></address_component><geometry><location><lat>37.7738430</lat><lng>-122.4169240</lng></location><location_type>ROOFTOP</location_type><viewport><southwest><lat>37.7706954</lat><lng>-122.4200716</lng></southwest><northeast><lat>37.7769906</lat><lng>-122.4137764</lng></northeast></viewport></geometry></result><result><type>neighborhood</type><type>political</type><formatted_address>SoMa, San Francisco, CA, USA</formatted_address><address_component><long_name>SoMa</long_name><short_name>SoMa</short_name><type>neighborhood</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><geometry><location><lat>37.7774052</lat><lng>-122.4099154</lng></location><location_type>APPROXIMATE</location_type><viewport><southwest><lat>37.7689350</lat><lng>-122.4228488</lng></southwest><northeast><lat>37.7875290</lat><lng>-122.3964000</lng></northeast></viewport><bounds><southwest><lat>37.7689350</lat><lng>-122.4228488</lng></southwest><northeast><lat>37.7875290</lat><lng>-122.3964000</lng></northeast></bounds></geometry></result><result><type>postal_code</type><formatted_address>San Francisco, CA 94103, USA</formatted_address><address_component><long_name>94103</long_name><short_name>94103</short_name><type>postal_code</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><geometry><location><lat>37.7726402</lat><lng>-122.4099154</lng></location><location_type>APPROXIMATE</location_type><viewport><southwest><lat>37.7635609</lat><lng>-122.4278650</lng></southwest><northeast><lat>37.7882800</lat><lng>-122.3978120</lng></northeast></viewport><bounds><southwest><lat>37.7635609</lat><lng>-122.4278650</lng></southwest><northeast><lat>37.7882800</lat><lng>-122.3978120</lng></northeast></bounds></geometry></result><result><type>neighborhood</type><type>political</type><formatted_address>Central East, San Francisco, CA, USA</formatted_address><address_component><long_name>Central East</long_name><short_name>Central East</short_name><type>neighborhood</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><geometry><location><lat>37.7615966</lat><lng>-122.4070834</lng></location><location_type>APPROXIMATE</location_type><viewport><southwest><lat>37.7311310</lat><lng>-122.4363820</lng></southwest><northeast><lat>37.7957000</lat><lng>-122.3767159</lng></northeast></viewport><bounds><southwest><lat>37.7311310</lat><lng>-122.4363820</lng></southwest><northeast><lat>37.7957000</lat><lng>-122.3767159</lng></northeast></bounds></geometry></result><result><type>administrative_area_level_3</type><type>political</type><formatted_address>San Francisco, CA, USA</formatted_address><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_3</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><geometry><location><lat>37.7618219</lat><lng>-122.5146439</lng></location><location_type>APPROXIMATE</location_type><viewport><southwest><lat>37.6398299</lat><lng>-123.1738250</lng></southwest><northeast><lat>37.9298239</lat><lng>-122.2817800</lng></northeast></viewport><bounds><southwest><lat>37.6398299</lat><lng>-123.1738250</lng></southwest><northeast><lat>37.9298239</lat><lng>-122.2817800</lng></northeast></bounds></geometry></result><result><type>administrative_area_level_2</type><type>political</type><formatted_address>San Francisco, California, USA</formatted_address><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><geometry><location><lat>37.7618219</lat><lng>-122.5146439</lng></location><location_type>APPROXIMATE</location_type><viewport><southwest><lat>37.6398299</lat><lng>-123.1738250</lng></southwest><northeast><lat>37.9298239</lat><lng>-122.2817800</lng></northeast></viewport><bounds><southwest><lat>37.6398299</lat><lng>-123.1738250</lng></southwest><northeast><lat>37.9298239</lat><lng>-122.2817800</lng></northeast></bounds></geometry></result><result><type>locality</type><type>political</type><formatted_address>San Francisco, CA, USA</formatted_address><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>locality</type><type>political</type></address_component><address_component><long_name>San Francisco</long_name><short_name>San Francisco</short_name><type>administrative_area_level_2</type><type>political</type></address_component><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><geometry><location><lat>37.7749295</lat><lng>-122.4194155</lng></location><location_type>APPROXIMATE</location_type><viewport><southwest><lat>37.7034000</lat><lng>-122.5270000</lng></southwest><northeast><lat>37.8120000</lat><lng>-122.3482000</lng></northeast></viewport><bounds><southwest><lat>37.7034000</lat><lng>-122.5270000</lng></southwest><northeast><lat>37.8120000</lat><lng>-122.3482000</lng></northeast></bounds></geometry></result><result><type>administrative_area_level_1</type><type>political</type><formatted_address>California, USA</formatted_address><address_component><long_name>California</long_name><short_name>CA</short_name><type>administrative_area_level_1</type><type>political</type></address_component><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><geometry><location><lat>36.7782610</lat><lng>-119.4179324</lng></location><location_type>APPROXIMATE</location_type><viewport><southwest><lat>32.5288320</lat><lng>-124.4820030</lng></southwest><northeast><lat>42.0095169</lat><lng>-114.1312110</lng></northeast></viewport><bounds><southwest><lat>32.5288320</lat><lng>-124.4820030</lng></southwest><northeast><lat>42.0095169</lat><lng>-114.1312110</lng></northeast></bounds></geometry></result><result><type>country</type><type>political</type><formatted_address>United States</formatted_address><address_component><long_name>United States</long_name><short_name>US</short_name><type>country</type><type>political</type></address_component><geometry><location><lat>37.0902400</lat><lng>-95.7128910</lng></location><location_type>APPROXIMATE</location_type><viewport><southwest><lat>18.7763000</lat><lng>170.5957000</lng></southwest><northeast><lat>71.5388000</lat><lng>-66.8850749</lng></northeast></viewport><bounds><southwest><lat>18.7763000</lat><lng>170.5957000</lng></southwest><northeast><lat>71.5388000</lat><lng>-66.8850749</lng></northeast></bounds></geometry></result></GeocodeResponse>
EOT;

   const GOOGLE_ERROR = <<<EOT
<?xml version="1.0" encoding="UTF-8"?>
<GeocodeResponse><status>ZERO_RESULTS</status></GeocodeResponse>
EOT;

   const GOOGLE_THROTTLE = <<<EOT
<?xml version="1.0" encoding="UTF-8"?>
<GeocodeResponse><status>OVER_QUERY_LIMIT</status><result></result></GeocodeResponse>
EOT;


   public function testGoogle()
   {
      $api = $this->getMock('GeoHelperGoogleGeocoder', array('callWebService'));
      $api->expects($this->once())->method('callWebService')->will($this->returnValue(self::GOOGLE_SUCCESS));
      
      $location = $api->geocode($this->full_address);
      $this->assertFullAddress($location);
   }
   
   public function testGoogleWithGeoLocation()
   {
      $api = $this->getMock('GeoHelperGoogleGeocoder', array('callWebService'));
      $api->expects($this->once())->method('callWebService')->will($this->returnValue(self::GOOGLE_SUCCESS));
      
      $location = $api->geocode($this->success);
      $this->assertFullAddress($location);
   }
   
   public function testGoogleMultipleLocations()
   {
      $api = $this->getMock('GeoHelperGoogleGeocoder', array('callWebService'));
      $api->expects($this->once())->method('callWebService')->will($this->returnValue(self::GOOGLE_MULTIPLE));
      
      $location = $api->geocode('Summer Breeze Dr.');
      $this->assertEquals(10, count($location->all));
   }
   
   public function testGoogleWithBounds()
   {
      $api = $this->getMock('GeoHelperGoogleGeocoder', array('callWebService'));
      $api->expects($this->once())->method('callWebService')->will($this->returnValue(self::GOOGLE_WITH_BOUNDS));
      
      $location = $api->geocode('Winnetka', array(
         'bounds' => GeoHelperBounds::normalize(array(34.172684,-118.604794), array(34.236144,-118.500938)),
      ));
      
      $this->assertEquals('CA', $location->state);
      $this->assertEquals('Los Angeles', $location->city);
   }
   
   public function testGoogleErrorFromService()
   {
      $api = $this->getMock('GeoHelperGoogleGeocoder', array('callWebService'));
      $api->expects($this->once())->method('callWebService')->will($this->returnValue(self::GOOGLE_ERROR));
      
      $location = $api->geocode($this->full_address);
      $this->assertFalse($location->success());
   }
   
   public function testGoogleConnectionError()
   {
      $api = $this->getMock('GeoHelperGoogleGeocoder', array('callWebService'));
      $api->expects($this->once())->method('callWebService')->will($this->throwException(new Exception));
      
      $location = $api->geocode($this->full_address);
      $this->assertFalse($location->success());
   }
   
   public function testGoogleTooManyQueriesError()
   {
      $api = $this->getMock('GeoHelperGoogleGeocoder', array('callWebService'));
      $api->expects($this->once())->method('callWebService')->will($this->returnValue(self::GOOGLE_THROTTLE));
      
      $this->setExpectedException('TooManyQueriesGeoHelperException');
      $location = $api->geocode($this->full_address);
   }
   
   public function testGoogleReverseGeocode()
   {
      $api = $this->getMock('GeoHelperGoogleGeocoder', array('callWebService'));
      $api->expects($this->once())->method('callWebService')->will($this->returnValue(self::GOOGLE_REVERSE));
      
      $location = $api->reverseGeocode($this->latlng);
      
      $this->assertEquals('CA', $location->state);
      $this->assertEquals('San Francisco', $location->city);
      $this->assertEquals('37.7738430,-122.4169240', $location->ll());
      $this->assertEquals('google', $location->provider);
      $this->assertEquals('building', $location->accuracy);
   }
   
   public function testGoogleReverseGeocodeConnectionError()
   {
      $api = $this->getMock('GeoHelperGoogleGeocoder', array('callWebService'));
      $api->expects($this->once())->method('callWebService')->will($this->throwException(new Exception));
      
      $location = $api->reverseGeocode($this->latlng);
      $this->assertFalse($location->success());
   }
   
   protected function assertFullAddress($location)
   {
      $this->assertEquals('CA', $location->state);
      $this->assertEquals('San Francisco', $location->city);
      $this->assertEquals('37.7921509,-122.3940000', $location->ll());
      $this->assertEquals('100 Spear St, San Francisco, CA 94105, USA', $location->full_address);
      $this->assertType('GeoHelperBounds', $location->suggested_bounds);
      $this->assertEquals('37.7890033,-122.3971476', $location->suggested_bounds->sw->ll());
      $this->assertEquals('37.7952985,-122.3908524', $location->suggested_bounds->ne->ll());
      $this->assertEquals('google', $location->provider);
      $this->assertEquals('building', $location->accuracy);
   }
}
